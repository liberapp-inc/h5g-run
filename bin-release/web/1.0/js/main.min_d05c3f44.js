function rand(){return globalRandom.v()}function randF(t,e){return globalRandom.f(t,e)}function randI(t,e){return globalRandom.i(t,e)}function randBool(){return globalRandom.bool()}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);i.prototype=e.prototype,t.prototype=new i},GameObject=function(){function t(){this.display=null,t.objects.push(this)}return t.prototype.destroy=function(){this.deleteFlag=!0},t.prototype.onDestroy=function(){},t.initial=function(e){t.display=e},t.process=function(){t.objects.forEach(function(t){return t.update()}),t.objects=t.objects.filter(function(t){return t.deleteFlag&&t._delete(),!t.deleteFlag}),t.transit&&(t.dispose(),t.transit(),t.transit=null)},t.dispose=function(){t.objects=t.objects.filter(function(t){return t.destroy(),t._delete(),!1})},t.prototype._delete=function(){this.onDestroy(),this.display&&(t.display.removeChild(this.display),this.display=null)},t.objects=[],t}();__reflect(GameObject.prototype,"GameObject");var Camera2D=function(){function t(){}return t.initial=function(){t.x=0,t.y=0,t.scale=1},t.transform=function(e,i){void 0===i&&(i=1),e.x=t.transX(e.x),e.y=t.transY(e.y),e.scaleX=e.scaleY=t.scale*i},t.transX=function(e){return(e-t.x)*t.scale},t.transY=function(e){return(e-t.y)*t.scale},t.x=0,t.y=0,t.scale=1,t}();__reflect(Camera2D.prototype,"Camera2D");var Coin=function(t){function e(e,i){var s=t.call(this)||this;return s.x=e,s.y=i,s.radius=Util.w(COIN_RADIUS_PER_W),s.setShape(e,i),s}return __extends(e,t),e.prototype.setShape=function(t,e){var i=this.display;null==this.display?(this.display=i=new egret.Shape,GameObject.display.addChild(this.display)):i.graphics.clear(),i.x=t,i.y=e,i.graphics.beginFill(COIN_COLOR),i.graphics.drawCircle(0,0,this.radius),i.graphics.endFill()},e.prototype.update=function(){this.display.x=this.x,this.display.y=this.y,Camera2D.transform(this.display),this.isPicked(),this.isOutOfScreen()},e.prototype.isPicked=function(){var t=Player.I.x-this.x,e=Player.I.y-this.y,i=Math.pow(t,2)+Math.pow(e,2);if(i<=Math.pow(Player.I.radius+this.radius,2))return Score.I.addPoint(1),this.destroy(),!0;if(Player.I.magnet>0){i=Math.sqrt(i);var s=1-Util.clamp(i/Util.w(.25),0,1);i=1/i*s*Util.width*.05,this.x+=t*i,this.y+=e*i}return!1},e.prototype.isOutOfScreen=function(){return this.x+this.radius<=Camera2D.x?(this.destroy(),!0):!1},e}(GameObject);__reflect(Coin.prototype,"Coin");var GAME_AREA_H_PER_W=1.2,PLAYER_RADIUS_PER_W=1/48,PLAYER_SPEED_PER_W=1/120,JUMP_POWER_PER_W=1/80,FLOATING_POWER_PER_W=1/1500,GRAVITY_PER_W=.001,MAX_VY_PER_W=1/80,CAMERA_POSITION_X=.2,COIN_RADIUS_PER_W=1/96,ITEM_RADIUS_PER_W=1/48,ITEM_LIMIT_FRAME=600,LAND_S_PW=1/8,LAND_M_PW=.25,LAND_L_PW=.5,BAR_RADIUS_PER_W=.25*PLAYER_RADIUS_PER_W,SAVE_KEY_BESTSCORE="run-bestScore",BACK_COLOR=16352026,BACK_COLOR2=16293402,SKY_COLOR=1486493,FONT_COLOR=16777215,FONT_COLOR2=16777215,PLAYER_COLOR=16777215,COIN_COLOR=16773120,BAR_COLOR=9703196,Game=function(){function t(){}return t.loadSceneGamePlay=function(){new Rect(0,0,Util.width,Util.h(.4),SKY_COLOR),new Rect(0,Util.h(.4),Util.width,Util.h(.1),BACK_COLOR2),new Player(Util.w(.25),Util.h(.5)),new Wave,new StartMessage,new Score},t}();__reflect(Game.prototype,"Game");var ItemType;!function(t){t[t.Big=0]="Big",t[t.Magnet=1]="Magnet"}(ItemType||(ItemType={}));var Item=function(t){function e(e,i,s){var a=t.call(this)||this;return a.x=e,a.y=i,a.radius=Util.w(ITEM_RADIUS_PER_W),a.type=s,a.setShape(e,i),a}return __extends(e,t),e.prototype.setShape=function(t,e){var i=this.display;switch(null==this.display?(this.display=i=new egret.Shape,GameObject.display.addChild(this.display)):i.graphics.clear(),i.x=t,i.y=e,this.type){case ItemType.Big:i.graphics.lineStyle(5,BAR_COLOR),i.graphics.drawRect(-this.radius,-this.radius,2*this.radius,2*this.radius),i.rotation=45;break;case ItemType.Magnet:i.graphics.lineStyle(5,COIN_COLOR),i.graphics.drawCircle(0,0,this.radius)}},e.prototype.update=function(){this.display.x=this.x,this.display.y=this.y,Camera2D.transform(this.display),this.isPicked(),this.isOutOfScreen()},e.prototype.isPicked=function(){var t=Player.I.x-this.x,e=Player.I.y-this.y,i=Math.pow(t,2)+Math.pow(e,2);if(i<=Math.pow(Player.I.radius+this.radius,2)){switch(this.type){case ItemType.Big:Player.I.big=ITEM_LIMIT_FRAME;break;case ItemType.Magnet:Player.I.magnet=ITEM_LIMIT_FRAME}return this.destroy(),!0}return!1},e.prototype.isOutOfScreen=function(){return this.x+this.radius<=Camera2D.x?(this.destroy(),!0):!1},e}(GameObject);__reflect(Item.prototype,"Item");var Player=function(t){function e(i,s){var a=t.call(this)||this;return a.state=a.stateNone,e.I=a,a.radius=Util.w(PLAYER_RADIUS_PER_W),a.color=PLAYER_COLOR,a.x=i,a.y=s,a.vx=0,a.vy=0,a.jumpButtomY=Util.h(.5),Camera2D.x=0,a.scrollCamera(1,1.7),a.setDisplay(),Camera2D.transform(a.display),a.button=new Button(null,0,0,.5,.5,1,1,0,0,null),a}return __extends(e,t),e.prototype.onDestroy=function(){this.button.destroy(),e.I=null},e.prototype.setDisplay=function(){var t=this.display;null==this.display?(this.display=t=new egret.Shape,GameObject.display.addChild(this.display)):t.graphics.clear(),t.x=this.x,t.y=this.y,t.graphics.beginFill(this.color),t.graphics.drawCircle(0,0,this.radius),t.graphics.endFill()},e.prototype.update=function(){this.state()},e.prototype.scrollCamera=function(t,e){void 0===t&&(t=1/32),void 0===e&&(e=1),Camera2D.x=Math.max(this.x-Util.w(CAMERA_POSITION_X),Camera2D.x),Camera2D.scale+=(e-Camera2D.scale)*t},e.prototype.setStateNone=function(){this.state=this.stateNone},e.prototype.stateNone=function(){},e.prototype.setStateRun=function(){this.state=this.stateRun},e.prototype.stateRun=function(){return this.itemEffect(),this.checkLand(),this.vx<0?void this.setStateMiss():(this.jump(),this.progress(!0),this.show(),void this.checkFall())},e.prototype.itemEffect=function(){var t,e=Util.w(PLAYER_RADIUS_PER_W)/30;this.big>0?(this.big--,t=2*Util.w(PLAYER_RADIUS_PER_W)):t=Util.w(PLAYER_RADIUS_PER_W),this.radius+=Util.clamp(t-this.radius,-e,+e),this.magnet>0&&(this.magnet--,this.color=0!=(4&this.magnet)?COIN_COLOR:PLAYER_COLOR)},e.prototype.jump=function(){this.button.touch?this.jumpButtonFrame++:this.jumpButtonFrame=0,this.jumping?0==this.landing?this.vy<0?this.floating&&(this.button.touch?this.vy-=Util.w(FLOATING_POWER_PER_W):this.floating=!1):this.floating&&(this.floating=!1,this.button.touch&&console.log("jump height"+(this.y-this.jumpButtomY).toFixed(0))):(this.jumping=!1,(this.button.press||this.button.touch&&this.jumpButtonFrame<=6)&&(this.vy=-Util.w(JUMP_POWER_PER_W),this.jumping=!0,this.floating=!0,this.landing=!1)):this.landing?(this.jumpButtomY=this.y,this.button.press&&(this.vy=-Util.w(JUMP_POWER_PER_W),this.jumping=!0,this.floating=!0,this.landing=!1)):this.floating=!1},e.prototype.progress=function(t){if(t){var e=Util.w(PLAYER_SPEED_PER_W)/12;this.vx+=Util.clamp(Util.w(PLAYER_SPEED_PER_W)-this.vx,-e,+e)}this.vy+=Util.w(GRAVITY_PER_W),this.vy=Math.min(this.vy,Util.w(MAX_VY_PER_W)),this.x+=this.vx,this.y+=this.vy},e.prototype.checkLand=function(){var t=this;this.landing=!1;var e=this.radius+Util.w(BAR_RADIUS_PER_W);Bar.bars.forEach(function(i){if(i.px0<t.x+e&&i.px1>t.x-e){var s=t.x-i.px0,a=t.y-i.py0,n=s*i.uvx+a*i.uvy;n=Util.clamp(n,0,i.length);var r=i.px0+i.uvx*n,o=i.py0+i.uvy*n;s=t.x-r,a=t.y-o;var h=Math.pow(s,2)+Math.pow(a,2);if(h<=Math.pow(e,2)){h=Math.sqrt(h);var l=1/h;s*=l,a*=l,n=e-h,t.x+=s*n,t.y+=a*n,n=s*t.vx+a*t.vy,t.vx-=s*n,t.vy-=a*n,0>a&&(t.landing=!0)}}})},e.prototype.show=function(){this.scrollCamera(),this.setDisplay(),Camera2D.transform(this.display,1)},e.prototype.checkFall=function(){return this.y-Camera2D.y>=Util.h(.5)+Util.w(GAME_AREA_H_PER_W/2)?(this.setStateMiss(),!0):!1},e.prototype.setStateMiss=function(){this.state!=this.stateMiss&&(new GameOver,this.state=this.stateMiss)},e.prototype.stateMiss=function(){this.checkFall()||(this.checkLand(),this.progress(!1),this.show())},e.I=null,e}(GameObject);__reflect(Player.prototype,"Player");var Wave=function(t){function e(){var i=t.call(this)||this;i.type=0,i.count=5,e.hardRate=0,i.waveX=0,i.lastPy=Util.h(.6);var s=i.waveX,a=Util.h(.5)+Util.w(.1),n=s+2*Util.w(LAND_L_PW),r=a;return new Bar(s,a,n,r),i.waveX+=2*Util.w(LAND_L_PW),i.lastPx=n,i.lastPy=r,i}return __extends(e,t),e.prototype.update=function(){if(Camera2D.x+Util.width>=this.waveX){switch(this.type){case 0:this.newSlope();break;case 1:this.newLand();break;case 2:this.newBumpy();break;case 3:this.newHoles();break;case 4:this.newSlopeHoles();break;case 5:this.newHoles();break;case 6:this.newSlopeHoles()}switch(e.hardRate=Util.clamp(this.waveX/Util.width/20,0,1),this.count--,this.count<=0&&(this.count=randI(4,11)*Util.lerp(1,.5,e.hardRate),this.type=randI(0,Util.lerp(2,7,e.hardRate))),randI(0,24)){case 0:case 1:case 2:this.newCoin2(this.lastPx,this.lastPy-Util.w(.15));break;case 3:case 4:case 5:this.newCoin3(this.lastPx,this.lastPy-Util.w(.2));break;case 6:new Item(this.lastPx,this.lastPy-Util.w(.15),ItemType.Big);break;case 7:new Item(this.lastPx,this.lastPy-Util.w(.2),ItemType.Magnet)}}},e.prototype.newSlope=function(){var t=this.waveX,e=this.lastPy,i=t+Util.w(LAND_L_PW),s=Util.h(.5)+Util.w(randF(.1,.3));new Bar(t,e,i,s),this.waveX+=Util.w(LAND_L_PW),this.lastPx=i,this.lastPy=s},e.prototype.newLand=function(){var t=this.waveX,e=Util.h(.5)+Util.w(randF(.1,.3)),i=t+Util.w(LAND_L_PW),s=e;new Bar(t,e,i,s),this.waveX+=Util.w(LAND_L_PW),this.lastPx=i,this.lastPy=s},e.prototype.newBumpy=function(){var t=this.waveX,e=Util.h(.5)+Util.w(randF(.1,.3)),i=t+Util.w(LAND_M_PW),s=e;new Bar(t,e,i,s),this.waveX+=Util.w(LAND_M_PW),this.lastPx=i,this.lastPy=s},e.prototype.newHoles=function(){var t=this.waveX,i=Util.h(.5)+Util.w(randF(.2,.3)),s=t+Util.w(LAND_M_PW)*randF(.25,Util.lerp(.8,.6,e.hardRate)),a=i;new Bar(t,i,s,a),this.waveX+=Util.w(LAND_M_PW),this.lastPx=s,this.lastPy=a},e.prototype.newSlopeHoles=function(){var t=this.waveX,i=Util.h(.5)+Util.w(randF(.12,.18)),s=t+Util.w(LAND_L_PW)*randF(.5,.8)*Util.lerp(1,.8,e.hardRate),a=Util.h(.5)+Util.w(randF(.12,.18));new Bar(t,i,s,a),this.waveX+=Util.w(LAND_L_PW),this.lastPx=s,this.lastPy=a},e.prototype.newCoin2=function(t,e){new Coin(t-Util.w(.04),e),new Coin(t+Util.w(.04),e)},e.prototype.newCoin3=function(t,e){new Coin(t-Util.w(.06),e),new Coin(t,e),new Coin(t+Util.w(.06),e)},e}(GameObject);__reflect(Wave.prototype,"Wave");var Button=function(t){function e(e,i,s,a,n,r,o,h,l,p){var c=t.call(this)||this;c.text=null,c.onTap=null,c.press=!1,c.touch=!1,c.x=0,c.y=0;var u=new egret.Shape;GameObject.display.addChild(u),u.graphics.beginFill(h,l);var d=r*Util.width,y=o*Util.height;return u.graphics.drawRoundRect(-.5*d,-.5*y,d,y,.2*d),u.graphics.endFill(),u.touchEnabled=!0,u.x=a*Util.width,u.y=n*Util.height,c.display=u,e&&(c.text=Util.newTextField(e,i,s,a,n,!0,!1),GameObject.display.addChild(c.text)),c.onTap=p,c.onTap&&c.display.addEventListener(egret.TouchEvent.TOUCH_TAP,c.onTap,c),c.display.addEventListener(egret.TouchEvent.TOUCH_BEGIN,c.touchBegin,c),c.display.addEventListener(egret.TouchEvent.TOUCH_MOVE,c.touchMove,c),c.display.addEventListener(egret.TouchEvent.TOUCH_END,c.touchEnd,c),c}return __extends(e,t),e.prototype.onDestroy=function(){this.onTap&&this.display.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),GameObject.display.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),GameObject.display.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),GameObject.display.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.text&&GameObject.display.removeChild(this.text)},e.prototype.update=function(){var t=this.touch?1.1:1;this.display.scaleX=this.display.scaleY=this.display.scaleX+.25*(t-this.display.scaleX),this.press=!1},e.prototype.touchBegin=function(t){this.x=t.stageX,this.y=t.stageY,this.press=!0,this.touch=!0},e.prototype.touchMove=function(t){this.x=t.stageX,this.y=t.stageY,this.touch=!0},e.prototype.touchEnd=function(t){this.touch=!1},e}(GameObject);__reflect(Button.prototype,"Button");var Bar=function(t){function e(i,s,a,n){var r=t.call(this)||this;e.bars.push(r),r.px0=i,r.py0=s,r.px1=a,r.py1=n,r.uvx=a-i,r.uvy=n-s,r.length=Math.sqrt(Math.pow(r.uvx,2)+Math.pow(r.uvy,2));var o=1/r.length;return r.uvx*=o,r.uvy*=o,r.setDisplay(),Camera2D.transform(r.display),r}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;e.bars=e.bars.filter(function(e){return e!=t})},e.prototype.setDisplay=function(){var t=this.display;null==this.display?(this.display=t=new egret.Shape,GameObject.display.addChildAt(this.display,1)):t.graphics.clear(),t.graphics.lineStyle(5,BAR_COLOR),t.graphics.moveTo(this.px0,this.py0),t.graphics.lineTo(this.px1,this.py1)},e.prototype.update=function(){this.display.x=this.display.y=0,Camera2D.transform(this.display),this.display.x+this.px1<0&&(this.destroy(),Score.I.addPoint(1))},e.bars=[],e}(GameObject);__reflect(Bar.prototype,"Bar");var Main=function(t){function e(){var e=t.call(this)||this;return e.once(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e}return __extends(e,t),e.prototype.addToStage=function(){Util.init(this),GameObject.initial(this.stage),Camera2D.initial(),Game.loadSceneGamePlay(),egret.startTick(this.tickLoop,this)},e.prototype.tickLoop=function(t){return GameObject.process(),!1},e}(eui.UILayer);__reflect(Main.prototype,"Main");var Random=function(){function t(e){void 0===e&&(e=Math.floor(Math.random()*t.max)),this.x=123456789,this.y=362436069,this.z=521288629,this.w=e}return t.prototype.v=function(){return(this.next()&t.max)/(t.max+1)},t.prototype.f=function(t,e){return t+this.v()*(e-t)},t.prototype.i=function(t,e){return Math.floor(this.f(t,e))},t.prototype.bool=function(){return 0!=(1&this.next())},t.prototype.next=function(){var t;return t=this.x^this.x<<11,this.x=this.y,this.y=this.z,this.z=this.w,this.w=this.w^this.w>>>19^(t^t>>>8)},t.max=1073741823,t}();__reflect(Random.prototype,"Random");var globalRandom=new Random,Rect=function(t){function e(e,i,s,a,n){var r=t.call(this)||this,o=new egret.Shape;return r.display=o,GameObject.display.addChild(r.display),o.graphics.beginFill(n,1),o.graphics.drawRect(e,i,s,a),o.graphics.endFill(),r}return __extends(e,t),e.prototype.update=function(){},e}(GameObject);__reflect(Rect.prototype,"Rect");var Util=function(){function t(){}return t.w=function(e){return e*t.width},t.h=function(e){return e*t.height},t.init=function(t){this.width=t.stage.stageWidth,this.height=t.stage.stageHeight},t.clamp=function(t,e,i){return e>t&&(t=e),t>i&&(t=i),t},t.lerp=function(t,e,i){return t+(e-t)*i},t.color=function(t,e,i){return 65536*Math.floor(255*t)+256*Math.floor(255*e)+Math.floor(255*i)},t.colorLerp=function(t,e,i){var s=1-i,a=((16711680&t)*s+(16711680&e)*i&16711680)+((65280&t)*s+(65280&e)*i&65280)+((255&t)*s+(255&e)*i&255);return a},t.newTextField=function(e,i,s,a,n,r,o){var h=new egret.TextField;return h.text=e,h.bold=r,h.size=i,h.textColor=s,o?(h.x=(t.width-h.width)*a,h.y=(t.height-h.height)*n):(h.x=t.width*a-.5*h.width,h.y=t.height*n-.5*h.height),h},t}();__reflect(Util.prototype,"Util");var GameOver=function(t){function e(){var e=t.call(this)||this;return e.texts=[],e.retryButton=null,e.step=0,e.fadeInFrame=64,e.texts[0]=Util.newTextField("SCORE : "+Score.I.point.toFixed(),Util.width/12,FONT_COLOR,.5,.35,!0,!1),egret.Tween.get(e.texts[0],{loop:!1}).to({alpha:0},0).to({alpha:1},1e3),GameObject.display.addChild(e.texts[0]),e}return __extends(e,t),e.prototype.onDestroy=function(){this.texts.forEach(function(t){GameObject.display.removeChild(t)}),this.texts=null},e.prototype.update=function(){this.step++,this.step==this.fadeInFrame&&(this.retryButton=new Button("リトライ",Util.width/16,BACK_COLOR,.5,.75,.4,.1,FONT_COLOR,1,this.onTapRetry),Score.I.point>Score.I.bestScore&&(egret.localStorage.setItem(SAVE_KEY_BESTSCORE,Score.I.point.toFixed()),this.texts[1]=Util.newTextField("NEW RECORD!",Util.width/13,FONT_COLOR,.5,.45,!0,!1),egret.Tween.get(this.texts[1],{loop:!0}).to({alpha:0},500).to({alpha:1},500),GameObject.display.addChild(this.texts[1])))},e.prototype.onTapRetry=function(){GameObject.transit=Game.loadSceneGamePlay,this.destroy()},e}(GameObject);__reflect(GameOver.prototype,"GameOver");var Score=function(t){function e(){var i=t.call(this)||this;i.point=0,i.bestScore=0,i.text=null,i.textBest=null,e.I=i,i.point=0,i.text=Util.newTextField("0",Util.width/22,FONT_COLOR2,.5,0,!0,!0),GameObject.display.addChild(i.text);var s=egret.localStorage.getItem(SAVE_KEY_BESTSCORE);return null==s&&(s="10",egret.localStorage.setItem(SAVE_KEY_BESTSCORE,s)),i.bestScore=parseInt(s),i.textBest=Util.newTextField("BEST:"+s,Util.width/22,FONT_COLOR2,0,0,!0,!0),GameObject.display.addChild(i.textBest),i}return __extends(e,t),e.prototype.onDestroy=function(){GameObject.display.removeChild(this.text),this.text=null,GameObject.display.removeChild(this.textBest),this.textBest=null,e.I=null},e.prototype.update=function(){},e.prototype.addPoint=function(t){void 0===t&&(t=1),this.point+=t,this.text.text=""+this.point.toFixed(),this.bestScore<this.point&&(this.textBest.text="BEST:"+this.point.toFixed())},e.I=null,e}(GameObject);__reflect(Score.prototype,"Score");var StartMessage=function(t){function e(){var e=t.call(this)||this;return e.texts=[],e.texts[0]=Util.newTextField("ボール走",Util.width/12,FONT_COLOR,.5,.2,!0,!1),e.texts[1]=Util.newTextField("タッチでジャンプ",Util.width/19,FONT_COLOR,.5,.3,!0,!1),e.texts[2]=Util.newTextField("落ちないように進め",Util.width/19,FONT_COLOR,.5,.35,!0,!1),e.texts.forEach(function(t){GameObject.display.addChild(t)}),GameObject.display.once(egret.TouchEvent.TOUCH_BEGIN,e.tap,e),e}return __extends(e,t),e.prototype.onDestroy=function(){this.texts.forEach(function(t){GameObject.display.removeChild(t)}),this.texts=null},e.prototype.update=function(){},e.prototype.tap=function(t){Player.I.setStateRun(),this.destroy()},e}(GameObject);__reflect(StartMessage.prototype,"StartMessage");